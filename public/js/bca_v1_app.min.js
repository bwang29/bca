/*! Built for bca_v1 2013-12-01 */
var ALL;ALL=function(){function a(){}return a.prototype.model={dummy:null},a.prototype.init=function(){var a;return a=this,BCA.db_uploads=new Firebase("https://bca.firebaseIO.com/uploads"),BCA.db_uploads.once("value",function(b){var c,d,e,f,g,h;f=b.val(),e=[];for(c in f){g=f[c];for(d in g)h=g[d],h.id=c,e.push(h)}return e.sort(function(a,b){return b.time-a.time}),BCA.ui.render_rewrite(null,"page_all",a.model,function(){return BCA.ui.render_rewrite("all_posts","module_post",{posts:e,allow_delete:!1,show_time:!1},function(){})})}),this},a}();var FEED;FEED=function(){function a(){}return a.prototype.model={dummy:"",fb_user:null,today:"",posts_array:null},a.prototype.bind_submit_image=function(){return BCA.ui.make_jq_img_upload("jq_image_upload","image_upload_wrapper","image_upload_progress",function(a){return BCA.db_uploads.child(BCA.fb_user.id).push({url:a,time:new Date-0,reflect:"",note:""})})},a.prototype.bind_submit_reflection=function(){var a;return a=this,$("#submit_reflection").click(function(){var a;return a=$("#my_reflection").val().trim(),a.length<10?alert("Your relection is too short!"):BCA.db_uploads.child(BCA.fb_user.id).push({url:"",time:new Date-0,reflect:a,note:""})})},a.prototype.render_cal=function(a){var b;return a||(a=b.get_current_month()),b=this,$("#calendar").html(BCA.ui.make_cal(a-1)),BCA.ui.schedule(function(){var c,d,e,f,g,h,i,j;for(12===a&&$(".next_month").hide(),1===a&&$(".prev_month").hide(),$(".prev_month").unbind().click(function(){return b.render_cal(a-1)}),$(".next_month").unbind().click(function(){return b.render_cal(a+1)}),e=0,j=b.model.posts_array,f=h=0,i=j.length;i>h;f=++h)g=j[f],""!==g.url&&(d=parseInt(g.time.split("/")[1].trim()),c=parseInt(g.time.split("/")[2].trim())+e,$(".d_"+d+"_"+c+" div").css("background-image","url("+g.url+")"),$(".d_"+d+"_"+c).data("idx",f),e+=1);return 0===b.model.posts_array.length&&$("#preview").html("<div style='text-align:center;padding-top:100px'>No activity uploaded.</div>"),$(".c_date").unbind().click(function(){return f=$(this).data("idx"),"undefined"!=typeof f?BCA.ui.render_rewrite("preview","module_post",{posts:[b.model.posts_array[f]],allow_delete:!1,show_time:!0},function(){}):void 0}),$($(".c_date")[0]).trigger("click")})},a.prototype.get_date=function(a){var b,c,d,e;return b=new Date(a),d=b.getUTCMonth()+1,c=b.getUTCDate()-1,e=b.getUTCFullYear(),e+" / "+d+" / "+c},a.prototype.get_current_month=function(){var a,b;return b=this,a=new Date,a.getUTCMonth()+1},a.prototype.render_previous_activity=function(){var a;return a=this,BCA.db_user_uploads=new Firebase("https://bca.firebaseIO.com/uploads/"+BCA.fb_user.id),BCA.db_user_uploads.on("value",function(b){var c,d,e,f;e=b.val(),d=[];for(c in e)f=e[c],f.time=a.get_date(f.time),f.id=c,d.push(f);return d=d.reverse(),d.length>=3&&""!==d[0].url&&""!==d[1].url&&""!==d[2].url?($("#image_upload_wrapper_bg").hide(),$("#reflection_wrapper_bg").show(),$("#done_today").hide(),$("#reflection_wrapper textarea").focus()):($("#image_upload_wrapper_bg").show(),$("#reflection_wrapper_bg").hide(),$("#done_today").hide()),a.model.posts_array=d,BCA.ui.render_rewrite("previous_activities","module_post",{posts:d,allow_delete:!0,show_time:!0},function(){return $(".trash_post").unbind().click(function(a){return confirm("Are you sure to delete this post?")?BCA.db_user_uploads.child($(a.target).data("id")).remove():void 0}),a.render_cal(a.get_current_month())})})},a.prototype.init=function(){var a;return a=this,BCA.db_user_tasks&&BCA.fb_user?(a.model.fb_user=BCA.fb_user,a.model.today=a.get_date(new Date),BCA.ui.render_rewrite(null,"page_feed",a.model,function(){return a.bind_submit_reflection(),a.bind_submit_image(),a.render_previous_activity()})):(BCA.rt.route_to(""),void 0)},a}();var HOME;HOME=function(){function a(){}return a.prototype.model={dummy:""},a.prototype.auth_and_setup=function(){var a;return a=this,BCA.auth=new FirebaseSimpleLogin(BCA.db,function(a,b){return $("#login_panel").fadeIn("fast"),a?console.log(a.message):b?($("#login_button").hide(),$("#logout_button").show(),$("#restart_button").hide(),BCA.fb_user=b,BCA.db_users.child(b.id).set(b),console.log("User ID: "+b.id+", Provider: "+b.provider),BCA.db_user_tasks=new Firebase("https://bca.firebaseIO.com/tasks/"+b.id),BCA.db_user_tasks.once("value",function(a){return a.val()?($("#restart_button").show(),BCA.fb_user.task=a.val().goal,BCA.rt.route_to("feed")):BCA.rt.route_to("setup")})):(BCA.fb_user=null,$("#login_button").show(),$("#logout_button").hide(),$("#restart_button").hide(),console.log("user is logged out"))})},a.prototype.init=function(){var a;return a=this,BCA.ui.render_rewrite(null,"page_home",a.model,function(){return a.auth_and_setup()}),this},a}();var SETUP;SETUP=function(){function a(){}return a.prototype.model={dummy:"",preset_tasks:["Take a different path to work/school","Try a different food everyday","Take a picture of one single object"]},a.prototype.init=function(){var a;return a=this,$("#restart_button").hide(),BCA.db_user_tasks&&BCA.fb_user?BCA.ui.render_rewrite(null,"page_setup",a.model,function(){return $("#setup_button").unbind().click(function(){var a,b;return b=$("#my_own_task").val().trim(),b.length<5?alert("Your own task is too short!"):(a=b,BCA.db_user_tasks.set({goal:a,type:"self"},function(){return BCA.fb_user.task=a,$("#restart_button").show(),BCA.rt.route_to("feed")}))}),$(".preset_task").unbind().click(function(a){var b;return b=$(a.target).text(),BCA.db_user_tasks.set({goal:b,type:"pre_set"},function(){return BCA.fb_user.task=b,$("#restart_button").show(),BCA.rt.route_to("feed")})})}):(BCA.rt.route_to(""),void 0)},a}();