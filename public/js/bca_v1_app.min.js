/*! Built for bca_v1 2013-12-01 */
var ALL;ALL=function(){function a(){}return a.prototype.model={dummy:null},a.prototype.init=function(){var a;return a=this,BCA.db_uploads=new Firebase("https://bca.firebaseIO.com/uploads"),BCA.db_uploads.once("value",function(a){var b,c,d,e,f,g;e=a.val(),d=[];for(b in e){f=e[b];for(c in f)g=f[c],g.id=b,d.push(g)}return console.log(d),d.sort(function(a,b){return b.time-a.time}),BCA.ui.render_rewrite($("body"),"module_post_all",{posts:d},function(){})}),this},a}();var FEED;FEED=function(){function a(){}return a.prototype.model={dummy:""},a.prototype.bind_submit_image=function(){return BCA.ui.make_jq_img_upload("jq_image_upload","image_upload_wrapper","image_upload_progress",function(a){return BCA.db_uploads.child(BCA.fb_user.id).push({url:a,time:new Date-0,reflect:"",note:""})})},a.prototype.bind_submit_reflection=function(){var a;return a=this,$("#submit_reflection").click(function(){var a;return a=$("#my_reflection").val().trim(),a.length<10?alert("Your relection is too short!"):BCA.db_uploads.child(BCA.fb_user.id).push({url:"",time:new Date-0,reflect:a,note:""})})},a.prototype.init=function(){var a;return a=this,BCA.db_user_tasks&&BCA.fb_user?BCA.ui.render_rewrite(null,"page_feed",a.model,function(){return BCA.db_user_uploads=new Firebase("https://bca.firebaseIO.com/uploads/"+BCA.fb_user.id),BCA.db_user_uploads.on("value",function(a){var b,c,d,e,f,g,h,i;g=a.val(),f=[];for(d in g)h=g[d],b=new Date(h.time),e=b.getUTCMonth(),c=b.getUTCDate(),i=b.getUTCFullYear(),h.time=i+" / "+e+" / "+c,h.id=d,f.push(h);return f.length%4===0&&f.length>0,BCA.ui.render_rewrite("previous_activities","module_post",{posts:f.reverse()},function(){return $(".trash_post").unbind().click(function(a){var b;return b=confirm("Are you sure to delete this post?"),b?BCA.db_user_uploads.child($(a.target).data("id")).remove():void 0})})})}):(BCA.rt.route_to(""),void 0)},a}();var HOME;HOME=function(){function a(){}return a.prototype.model={dummy:""},a.prototype.auth_and_setup=function(){var a;return a=this,BCA.auth=new FirebaseSimpleLogin(BCA.db,function(a,b){return a?console.log(a.message):b?(BCA.fb_user=b,BCA.db_users.child(b.id).set(b),$("#hello_msg").text(b.name),console.log("User ID: "+b.id+", Provider: "+b.provider),BCA.db_user_tasks=new Firebase("https://bca.firebaseIO.com/tasks/"+b.id),BCA.db_user_tasks.once("value",function(a){return a.val()?BCA.rt.route_to("feed"):BCA.rt.route_to("setup")})):(BCA.fb_user=null,console.log("user is logged out"))})},a.prototype.init=function(){var a;return a=this,BCA.ui.render_rewrite(null,"page_home",a.model,function(){return a.auth_and_setup()}),this},a}();var SETUP;SETUP=function(){function a(){}return a.prototype.model={dummy:"",preset_tasks:["Take a photo a day","Eat a different food everyday"]},a.prototype.init=function(){var a;return a=this,BCA.db_user_tasks&&BCA.fb_user?BCA.ui.render_rewrite(null,"page_setup",a.model,function(){return $("#setup_button").unbind().click(function(){var a;return a=$("#my_own_task").val().trim(),a.length<5?alert("Your own task is too short!"):BCA.db_user_tasks.set({goal:a,type:"self"},function(){return BCA.rt.route_to("feed")})}),$(".preset_task").unbind().click(function(a){var b;return b=$(a.target).text(),BCA.db_user_tasks.set({goal:b,type:"pre_set"},function(){return BCA.rt.route_to("feed")})})}):(BCA.rt.route_to(""),void 0)},a}();