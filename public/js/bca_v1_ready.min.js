/*! Built for bca_v1 2013-11-19 */
var _this=this;BCA.rt=Davis(function(){return this.configure(function(){return this.generateRequestOnPageLoad=!0}),this.get("/",function(){})}),BCA.rt.route_to=function(){return Davis.location.assign("/"+Array.prototype.join.call(arguments,"/"))},BCA.rt.bind("runRoute",function(){}).bind("routeNotFound",function(){}).bind("start",function(){return BCA.rt.logger.info("BCA started"),BCA.fb_user=null,BCA.db=new Firebase("https://bca.firebaseIO.com"),BCA.db_users=new Firebase("https://bca.firebaseIO.com/users"),BCA.db_uploads=new Firebase("https://bca.firebaseIO.com/uploads"),BCA.db_tasks=new Firebase("https://bca.firebaseIO.com/tasks"),BCA.setup_complete=function(){return $(".to_hide").show(),BCA.db_user_uploads=new Firebase("https://bca.firebaseIO.com/uploads/"+BCA.fb_user.id),BCA.db_user_uploads.on("value",function(a){var b,c,d,e,f,g,h,i;g=a.val(),f=[];for(d in g)h=g[d],b=new Date(h.time),e=b.getUTCMonth(),c=b.getUTCDate(),i=b.getUTCFullYear(),h.time=i+" / "+e+" / "+c,h.id=d,f.push(h);return console.log(f),f.length%4===0?($(".to_upload").hide(),$(".to_reflect").show()):($(".to_reflect").hide(),$(".to_upload").show()),BCA.ui.render_rewrite($("#previous_activities"),"module_post",{posts:f.reverse()},function(){return $(".trash_post").unbind().click(function(a){var b;return b=confirm("Are you sure to delete this post?"),b?BCA.db_user_uploads.child($(a.target).data("id")).remove():void 0})})})},BCA.auth=new FirebaseSimpleLogin(BCA.db,function(a,b){return a?console.log(a.message):b?(BCA.fb_user=b,$(".to_show").hide(),$(".to_setup").hide(),$("#hello_msg").text(b.name),BCA.db_users.child(b.id).set(b),console.log("User ID: "+b.id+", Provider: "+b.provider),BCA.db_user_tasks=new Firebase("https://bca.firebaseIO.com/tasks/"+b.id),BCA.db_user_tasks.once("value",function(a){return a.val()?($("#user_task").text(a.val().goal),BCA.setup_complete()):($(".to_setup").show(),$("#setup_button").unbind().click(function(){var a;return a=$("#my_own_task").val().trim(),a.length<5?alert("Your own task is too short!"):BCA.db_user_tasks.set({goal:a,type:"self"},function(){return $("#user_task").text(a),$(".to_setup").hide(),BCA.setup_complete()})}))})):(BCA.fb_user=null,$(".to_hide").hide(),$(".to_setup").hide(),$(".to_show").show(),console.log("user is logged out"))}),BCA.ui.render_rewrite($("body"),"wrapper",{},function(){return BCA.rt.logger.info("BCA wrapper rendered"),$("#login_button").unbind().click(function(){return BCA.auth.login("facebook",{rememberMe:!0,scope:"email"})}),$("#logout_button").unbind().click(function(){return BCA.auth.logout()}),$("#restart_button").unbind().click(function(){var a;return a=confirm("Are you sure to restart? All progress will be lost!"),a?(BCA.db_user_uploads.remove(),BCA.db_user_tasks.remove(),BCA.auth.logout()):void 0}),$("#submit_reflection").click(function(){var a;return a=$("#my_reflection").val().trim(),a.length<10?alert("Your relection is too short!"):BCA.db_uploads.child(BCA.fb_user.id).push({url:"",time:new Date-0,reflect:a,note:""})}),BCA.ui.make_jq_img_upload("jq_image_upload","image_upload_wrapper","image_upload_progress",function(a){return BCA.db_uploads.child(BCA.fb_user.id).push({url:a,time:new Date-0,reflect:"",note:""})})})}).bind("stop",function(){return BCA.rt.logger.info("BCA stopped")}),BCA.rt.start();